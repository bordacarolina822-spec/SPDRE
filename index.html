<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPDR E - Solicitud de Derivaci√≥n</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SPDR E - Sistema Provincial de Derivaci√≥n</h1>
            <p>Solicitud de Derivaci√≥n de Emergencia</p>
        </div>

        <div class="progress-bar">
            <div class="progress-step active" data-step="1">
                <div class="progress-circle">1</div>
                <div class="progress-label">Paciente</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="progress-circle">2</div>
                <div class="progress-label">Emergencia</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="progress-circle">3</div>
                <div class="progress-label">Confirmar</div>
            </div>
        </div>

        <div class="form-container">
            <!-- PASO 1: Identificaci√≥n del Paciente -->
            <div class="step active" id="step1">
                <h2 style="margin-bottom: 24px;">Paso 1: Identificaci√≥n del Paciente</h2>
                
                <div class="alert alert-info">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        <strong>Consulta con HSI:</strong> El sistema intentar√° validar la identidad consultando la Historia de Salud Integrada. Si la consulta falla, se activar√° el Protocolo de Paciente Temporal.
                    </div>
                </div>

                <div class="form-group">
                    <label for="dni">DNI del Paciente <span class="required">*</span></label>
                    <input type="text" id="dni" placeholder="Ej: 12345678" required>
                </div>

                <div class="form-group">
                    <label for="nombres">Nombres <span class="required">*</span></label>
                    <input type="text" id="nombres" placeholder="Nombres del paciente" required>
                </div>

                <div class="form-group">
                    <label for="apellidos">Apellidos <span class="required">*</span></label>
                    <input type="text" id="apellidos" placeholder="Apellidos del paciente" required>
                </div>

                <div class="form-group">
                    <label for="edad">Edad <span class="required">*</span></label>
                    <input type="number" id="edad" placeholder="Edad en a√±os" required>
                </div>

                <div class="form-group">
                    <label for="genero">G√©nero <span class="required">*</span></label>
                    <select id="genero" required>
                        <option value="">Seleccione...</option>
                        <option value="masculino">Masculino</option>
                        <option value="femenino">Femenino</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="capsOrigen">CAPS de Origen <span class="required">*</span></label>
                    <select id="capsOrigen" required>
                        <option value="">Seleccione el CAPS...</option>
                        <option value="caps_eva_peron">CAPS Eva Per√≥n</option>
                        <option value="caps_virgen_cerros">CAPS Virgen de los Cerros</option>
                        <option value="caps_san_vicente">CAPS San Vicente de Paul</option>
                        <option value="caps_cochangasta">CAPS Cochangasta</option>
                        <option value="caps_sanagasta">CAPS Sanagasta</option>
                        <option value="caps_los_talas">CAPS Los Talas</option>
                        <option value="caps_castro_barros">CAPS Castro Barros</option>
                        <option value="caps_la_cruz">CAPS La Cruz</option>
                        <option value="caps_breakman">CAPS Breakman</option>
                        <option value="caps_el_brete">CAPS El Brete</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="hospitalDestino">Hospital Destino Preferido</label>
                    <select id="hospitalDestino">
                        <option value="">Sistema seleccionar√° autom√°ticamente...</option>
                        <option value="hospital_vera_barros">Hospital Provincial Dr. Enrique Vera Barros</option>
                        <option value="hospital_madre_nino">Hospital de la Madre y el Ni√±o</option>
                        <option value="hospital_perrando">Hospital Perrando</option>
                        <option value="hospital_san_juan">Hospital San Juan de Dios</option>
                        <option value="hospital_angel_padilla">Hospital Dr. √Ångel C. Padilla</option>
                    </select>
                    <small style="color: var(--text-muted); font-size: 13px; display: block; margin-top: 6px;">
                        ‚ÑπÔ∏è Opcional: El sistema sugerir√° el hospital √≥ptimo seg√∫n disponibilidad
                    </small>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="validarPaciente()">
                        Validar con HSI ‚Üí
                    </button>
                </div>
            </div>
            <!-- FIN PASO 1 -->

            <!-- PASO 2: Descripci√≥n de la Emergencia -->
            <div class="step" id="step2">
                <h2 style="margin-bottom: 24px;">Paso 2: Descripci√≥n de la Emergencia</h2>

                <div id="tempIdAlert" class="alert alert-warning" style="display: none;">
                    <span>‚ö†Ô∏è</span>
                    <div>
                        <strong>Protocolo de Paciente Temporal Activado</strong>
                        <p>No se pudo validar con HSI. Se ha generado un ID Temporal para continuar con la atenci√≥n de emergencia.</p>
                        <div class="temp-id-badge" id="tempIdDisplay"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nivel de Prioridad (Triage) <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="prioridad" id="prioridad1" value="critico">
                            <label for="prioridad1" class="radio-label">
                                üî¥ Cr√≠tico<br>
                                <small>Riesgo vital inmediato</small>
                            </label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="prioridad" id="prioridad2" value="urgente">
                            <label for="prioridad2" class="radio-label">
                                üü† Urgente<br>
                                <small>Requiere atenci√≥n r√°pida</small>
                            </label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="prioridad" id="prioridad3" value="programado">
                            <label for="prioridad3" class="radio-label">
                                üü° Programado<br>
                                <small>No urgente</small>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="motivoConsulta">Motivo de Consulta <span class="required">*</span></label>
                    <textarea id="motivoConsulta" placeholder="Describa brevemente el motivo de la consulta..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="diagnosticoPresuntivo">Diagn√≥stico Presuntivo <span class="required">*</span></label>
                    <input type="text" id="diagnosticoPresuntivo" placeholder="Ej: IAM, ACV, Trauma craneal..." required>
                </div>

                <div class="form-group">
                    <label>Recurso Cr√≠tico Requerido <span class="required">*</span></label>
                    <div class="resource-list" id="resourceList">
                        <div class="resource-item" onclick="selectResource(this, 'uci')">
                            <div>
                                <div class="resource-name">Cama UCI</div>
                                <small>Unidad de Cuidados Intensivos</small>
                            </div>
                            <span class="resource-availability available">Disponible</span>
                        </div>
                        <div class="resource-item" onclick="selectResource(this, 'respirador')">
                            <div>
                                <div class="resource-name">Respirador</div>
                                <small>Ventilaci√≥n mec√°nica</small>
                            </div>
                            <span class="resource-availability limited">Limitado</span>
                        </div>
                        <div class="resource-item" onclick="selectResource(this, 'quirofano')">
                            <div>
                                <div class="resource-name">Quir√≥fano</div>
                                <small>Cirug√≠a de emergencia</small>
                            </div>
                            <span class="resource-availability available">Disponible</span>
                        </div>
                        <div class="resource-item" onclick="selectResource(this, 'tomografia')">
                            <div>
                                <div class="resource-name">Tomograf√≠a</div>
                                <small>Estudio de diagn√≥stico</small>
                            </div>
                            <span class="resource-availability available">Disponible</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="observaciones">Observaciones Adicionales</label>
                    <textarea id="observaciones" placeholder="Informaci√≥n adicional relevante..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="cambiarPaso(1)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-primary" onclick="cambiarPaso(3)">
                        Continuar ‚Üí
                    </button>
                </div>
            </div>
            <!-- FIN PASO 2 -->

            <!-- PASO 3: Confirmaci√≥n y Env√≠o -->
            <div class="step" id="step3">
                <h2 style="margin-bottom: 24px;">Paso 3: Confirmaci√≥n de Solicitud</h2>

                <div class="alert alert-info">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        Revise los datos antes de enviar. El sistema buscar√° autom√°ticamente el hospital m√°s adecuado y enviar√° la solicitud de forma inmediata.
                    </div>
                </div>

                <div class="summary-section">
                    <h3 style="margin-bottom: 16px;">Datos del Paciente</h3>
                    <div class="summary-item">
                        <span class="summary-label">DNI:</span>
                        <span class="summary-value" id="summaryDni"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Nombre:</span>
                        <span class="summary-value" id="summaryNombre"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Edad:</span>
                        <span class="summary-value" id="summaryEdad"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Estado de Validaci√≥n:</span>
                        <span class="summary-value" id="summaryValidacion"></span>
                    </div>
                </div>

                <div class="summary-section">
                    <h3 style="margin-bottom: 16px;">Detalles de la Emergencia</h3>
                    <div class="summary-item">
                        <span class="summary-label">Prioridad:</span>
                        <span class="summary-value" id="summaryPrioridad"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Diagn√≥stico:</span>
                        <span class="summary-value" id="summaryDiagnostico"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Recurso Requerido:</span>
                        <span class="summary-value" id="summaryRecurso"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Motivo:</span>
                        <span class="summary-value" id="summaryMotivo"></span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="cambiarPaso(2)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-success" onclick="enviarSolicitud()">
                        ‚úì Enviar Solicitud
                    </button>
                </div>
            </div>
            <!-- FIN PASO 3 -->

            <!-- Pantalla de Carga -->
            <div class="loading" id="loadingScreen">
                <div class="spinner"></div>
                <h3>Enviando solicitud...</h3>
                <p>Buscando hospital √≥ptimo y enviando notificaci√≥n</p>
            </div>

            <!-- Pantalla de √âxito -->
            <div class="step" id="successScreen">
                <div style="text-align: center;">
                    <div class="success-icon">‚úì</div>
                    <h2 style="color: var(--success-color); margin-bottom: 16px;">¬°Solicitud Enviada Exitosamente!</h2>
                    <p style="color: var(--text-muted); margin-bottom: 24px;">
                        La solicitud de derivaci√≥n ha sido enviada al hospital. Recibir√° una notificaci√≥n cuando sea aceptada.
                    </p>
                    
                    <div class="summary-section" style="text-align: left;">
                        <div class="summary-item">
                            <span class="summary-label">ID de Solicitud:</span>
                            <span class="summary-value" id="solicitudId"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Hora de Env√≠o:</span>
                            <span class="summary-value" id="horaEnvio"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Hospital Destino:</span>
                            <span class="summary-value" id="hospitalDestinoFinal"></span>
                        </div>
                    </div>

                    <div class="alert alert-success" style="margin-top: 24px;">
                        <span>‚úì</span>
                        <div style="text-align: left;">
                            <strong>Pr√≥ximos pasos:</strong>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li>El hospital revisar√° la solicitud</li>
                                <li>Recibir√° confirmaci√≥n en menos de 15 minutos</li>
                                <li>Puede hacer seguimiento en tiempo real</li>
                            </ul>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 32px;">
                        <button class="btn btn-primary" onclick="nuevaSolicitud()">
                            Nueva Solicitud
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>